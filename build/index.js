(()=>{"use strict";var e={464:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resetPassword=t.forgotPassword=t.login=t.signup=void 0;var o=r(752),s=r(432),a=r(805),n=r(155),i=r(465),u=r(268),d=r(211),c=r(490),p=r(840),_=r(377);t.signup=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var r,s,n,u,d,_,l,E,T,v;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return r=e.body,s=r.email,n=r.name,u=r.password,d=r.passwordConfirm,_=r.photo,l=r.passwordChangedAt,E=r.role,T=r.adminPassword,[4,a.UserModel.create({email:s,name:n,password:u,passwordConfirm:d,photo:_,passwordChangedAt:l,role:T&&T===(0,p.getEnv)("ADMIN_PASSWORD")?E:i.Role.user})];case 1:return v=o.sent(),t.json({status:"Success",message:"Successfully created a new user - "+v.name,data:{accessToken:(0,c.generateJwt)({_id:v._id})}}),[2]}}))}))})),t.login=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var n,i,u,p,_;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return n=e.body,i=n.email,u=n.password,[4,a.UserModel.findOne({email:i})];case 1:return p=o.sent(),(_=p)?[4,(0,s.compare)(u,p.password)]:[3,3];case 2:_=o.sent(),o.label=3;case 3:return _?t.status(400).json({status:"Success",message:"Successfully logged in",data:{accessToken:(0,c.generateJwt)({_id:p._id})}}):r(new d.CustomError("Invalid username or password",401)),[2]}}))}))})),t.forgotPassword=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var r,s;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,a.UserModel.findOne({email:e.body.email})];case 1:if(!(r=o.sent()))throw new d.CustomError("User not found",n.HttpStatus.NOT_FOUND);return s=r.createPasswordResetToken(),[4,r.save({validateBeforeSave:!1})];case 2:return o.sent(),(0,_.sendEmail)({email:"sachinaryal200@gmail.com",subject:"Password Reset Request",text:"Please send a patch request to http://localhost:4000/api/v1/users/resetPassword/"+s+" with new password and passwordConfirmation.If you didn't forgot your password,please ignore this email!"}).then((function(){return console.info("Successfully sent a password reset request")})).catch((function(e){return console.info(e)})),t.json({status:"Success",message:"Password Reset Request Sent"}),[2]}}))}))})),t.resetPassword=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var r,s,i,u,c;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return r=e.params.resetToken,s=e.body,i=s.newPassword,u=s.confirmNewPassword,[4,a.UserModel.findOne({passwordResetToken:r,passwordResetTokenExpiresIn:{$gt:Date.now()}})];case 1:if(!(c=o.sent()))throw new d.CustomError("Token is invalid or expired",n.HttpStatus.UNAUTHORIZED);return c.password=i,c.passwordConfirm=u,c.passwordResetToken=void 0,c.passwordResetTokenExpiresIn=void 0,[4,c.save({validateModifiedOnly:!0})];case 2:return o.sent(),t.json({status:"Success",message:"Successfully changed password"}),[2]}}))}))}))},602:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMonthlyPlan=t.getTourStats=t.deleteTour=t.updateTour=t.createTour=t.getTourById=t.getAllTours=void 0;var o=r(752),s=r(517),a=r(423),n=r(155),i=r(105),u=r(268),d=r(211);t.getAllTours=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var r,u,d,c;return(0,o.__generator)(this,(function(p){switch(p.label){case 0:return r=(0,s.omit)((0,o.__assign)({},e.query),["page","sort","limit","fields"]),r=JSON.parse(JSON.stringify(r).replace(/\b(gte|lte|gt|lt)\b/g,(function(e){return"$"+e}))),u=a.TourModel.find(r),(d=new i.ApiFeatures(u,e)).sort().fields().paginate(),[4,d.query];case 1:return c=p.sent(),t.status(n.HttpStatus.OK).json({status:"Success",results:c.length,data:{tours:c}}),[2]}}))}))})),t.getTourById=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var s;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,a.TourModel.findById(e.params.id)];case 1:return(s=o.sent())?t.status(n.HttpStatus.FOUND).json({status:"Success",data:{tour:s}}):r(new d.CustomError("Tour with id "+e.params.id+" not found",404)),[2]}}))}))})),t.createTour=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var r;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,a.TourModel.create(e.body)];case 1:return r=o.sent(),t.status(n.HttpStatus.CREATED).json({status:"Success",data:{tour:r}}),[2]}}))}))})),t.updateTour=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var s;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,a.TourModel.findByIdAndUpdate(e.params.id,e.body,{new:!0,runValidators:!0})];case 1:return(s=o.sent())?(t.status(n.HttpStatus.OK).json({status:"Success",data:{tour:s}}),[2]):[2,r(new d.CustomError("Tour with id "+e.params.id+" not found",404))]}}))}))})),t.deleteTour=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,a.TourModel.findByIdAndDelete(e.params.id)];case 1:return o.sent()?(t.status(n.HttpStatus.GONE).json({status:"Success",message:"Successfully deleted tour with id "+e.params.id}),[2]):[2,r(new d.CustomError("Tour with id "+e.params.id+" not found",404))]}}))}))})),t.getTourStats=(0,u.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var e;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return[4,a.TourModel.aggregate([{$group:{_id:{$toUpper:"$difficulty"},totalTours:{$sum:1},avgRatings:{$avg:"$ratingsAverage"},totalRatings:{$sum:"$ratingsQuantity"},avgPrice:{$avg:"$price"},minPrice:{$min:"$price"},maxPrice:{$max:"$price"}}}])];case 1:return e=r.sent(),t.status(n.HttpStatus.OK).json({status:"Success",results:e.length,data:{stats:e}}),[2]}}))}))})),t.getMonthlyPlan=(0,u.catchAsync)((function(e,t){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var r,s;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return r=e.params.year,[4,a.TourModel.aggregate([{$unwind:"$startDates"},{$addFields:{date:{$toDate:"$startDates"}}},{$match:{date:{$gte:new Date(r+"-01-01"),$lte:new Date(r+"-12-31")}}},{$group:{_id:{$month:"$date"},numOfTours:{$sum:1},tours:{$push:"$name"}}},{$sort:{_id:1}},{$addFields:{month:"$_id"}},{$unset:"_id"}])];case 1:return s=o.sent(),t.json({status:"success",results:s.length,data:{plan:s}}),[2]}}))}))}))},540:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.authenticated=void 0;var o=r(752),s=(0,o.__importDefault)(r(344)),a=r(517),n=r(837),i=r(805),u=r(155),d=r(268),c=r(211),p=r(840);t.authenticated=(0,d.catchAsync)((function(e,t,r){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var t,d,_,l,E;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return e.headers.authorization&&e.headers.authorization.startsWith("Bearer")?(t=(0,p.getEnv)("JWT_SECRET_KEY"),d=e.headers.authorization.split(" ")[1],[4,(0,n.promisify)(s.default.verify)(d,t)]):[3,3];case 1:return _=o.sent(),[4,i.UserModel.findById(_._id)];case 2:if(!(l=o.sent()))throw new c.CustomError("User doesn't exist or has been deleted",u.HttpStatus.FORBIDDEN);if(l.isPasswordChanged(_.iat))throw new c.CustomError("Unauthroized request.Please try logging back",u.HttpStatus.UNAUTHORIZED);return E=(0,a.pick)(l,["_id","name","email","photo","password","passwordConfirm","passwordChangedAt","role"]),e.user=E,r(),[3,4];case 3:throw new c.CustomError("Please include a bearer token in your request",u.HttpStatus.UNAUTHORIZED);case 4:return[2]}}))}))}))},817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cheapTours=void 0,t.cheapTours=function(e,t,r){e.query.limit="5",e.query.sort="price,averageRatings",r()}},547:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalErrors=void 0,t.globalErrors=function(e,t,r,o){var s,a;e.statusCode=null!==(s=e.statusCode)&&void 0!==s?s:500,e.status=null!==(a=e.status)&&void 0!==a?a:"Error",r.status(e.statusCode).json({status:e.status,message:e.message}),o()}},84:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.restrictTo=void 0;var o=r(155),s=r(211);t.restrictTo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t,r,a){if(t.user&&!e.includes(t.user.role))throw new s.CustomError("Restricted Route",o.HttpStatus.UNAUTHORIZED);a()}}},423:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TourModel=void 0;var o=r(752),s=r(868),a=function(){function e(){}return(0,o.__decorate)([(0,s.prop)({required:[!0,"A tour must have a name"],unique:!0}),(0,o.__metadata)("design:type",String)],e.prototype,"name",void 0),(0,o.__decorate)([(0,s.prop)({required:[!0,"A tour must have a duration"]}),(0,o.__metadata)("design:type",Number)],e.prototype,"duration",void 0),(0,o.__decorate)([(0,s.prop)({required:[!0,"A tour must have a max group size"]}),(0,o.__metadata)("design:type",Number)],e.prototype,"maxGroupSize",void 0),(0,o.__decorate)([(0,s.prop)({required:[!0,"Tour must have a difficulty"],enum:["easy","difficult","medium"]}),(0,o.__metadata)("design:type",String)],e.prototype,"difficulty",void 0),(0,o.__decorate)([(0,s.prop)({default:4.5,min:1,max:5}),(0,o.__metadata)("design:type",Number)],e.prototype,"ratingsAverage",void 0),(0,o.__decorate)([(0,s.prop)({default:0}),(0,o.__metadata)("design:type",Number)],e.prototype,"ratingsQuantity",void 0),(0,o.__decorate)([(0,s.prop)({required:[!0,"A tour must include price"]}),(0,o.__metadata)("design:type",Number)],e.prototype,"price",void 0),(0,o.__decorate)([(0,s.prop)({}),(0,o.__metadata)("design:type",Number)],e.prototype,"priceDiscount",void 0),(0,o.__decorate)([(0,s.prop)({trim:!0,required:[!0,"A tour must have a summary"]}),(0,o.__metadata)("design:type",String)],e.prototype,"summary",void 0),(0,o.__decorate)([(0,s.prop)({required:[!0,"A tour must have a description"]}),(0,o.__metadata)("design:type",String)],e.prototype,"description",void 0),(0,o.__decorate)([(0,s.prop)({required:[!0,"A tour must have a cover photo"]}),(0,o.__metadata)("design:type",String)],e.prototype,"imageCover",void 0),(0,o.__decorate)([(0,s.prop)(),(0,o.__metadata)("design:type",s.mongoose.Types.Array)],e.prototype,"images",void 0),(0,o.__decorate)([(0,s.prop)({default:Date.now()}),(0,o.__metadata)("design:type",Date)],e.prototype,"createdAt",void 0),(0,o.__decorate)([(0,s.prop)(),(0,o.__metadata)("design:type",s.mongoose.Types.Array)],e.prototype,"startDates",void 0),(0,o.__decorate)([(0,s.modelOptions)({options:{allowMixed:s.Severity.ALLOW}})],e)}();t.TourModel=(0,s.getModelForClass)(a)},805:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserModel=void 0;var o=r(752),s=r(868),a=r(432),n=r(113),i=r(465),u=function(){function e(){}return e.prototype.isPasswordChanged=function(e){return!!this.passwordChangedAt&&e<Number(this.passwordChangedAt.getTime()/1e3)},e.prototype.createPasswordResetToken=function(){var e=(0,n.randomBytes)(32).toString("hex");return this.passwordResetToken=(0,n.createHash)("sha256").update(e).digest("hex"),this.passwordResetTokenExpiresIn=(new Date).getTime()+6e5,this.passwordResetToken},(0,o.__decorate)([(0,s.prop)({unique:!0,required:[!0,"Name is required"]}),(0,o.__metadata)("design:type",String)],e.prototype,"name",void 0),(0,o.__decorate)([(0,s.prop)({unique:!0,required:[!0,"Email address is required"],lowercase:!0,validate:{validator:function(e){return/^([\w-.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(e)},message:"{VALUE} is not a valid email address"}}),(0,o.__metadata)("design:type",String)],e.prototype,"email",void 0),(0,o.__decorate)([(0,s.prop)(),(0,o.__metadata)("design:type",String)],e.prototype,"photo",void 0),(0,o.__decorate)([(0,s.prop)({minlength:8,required:[!0,"Password required"],validate:{validator:function(e){return/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/.test(e)},message:"Password too weak"}}),(0,o.__metadata)("design:type",String)],e.prototype,"password",void 0),(0,o.__decorate)([(0,s.prop)({required:[!0,"Confirmation password required"],validate:{validator:function(e){return e===this.password.slice()},message:"Password didnt match"}}),(0,o.__metadata)("design:type",Object)],e.prototype,"passwordConfirm",void 0),(0,o.__decorate)([(0,s.prop)(),(0,o.__metadata)("design:type",Date)],e.prototype,"passwordChangedAt",void 0),(0,o.__decorate)([(0,s.Prop)({enum:i.Role,default:i.Role.user}),(0,o.__metadata)("design:type",String)],e.prototype,"role",void 0),(0,o.__decorate)([(0,s.Prop)(),(0,o.__metadata)("design:type",String)],e.prototype,"passwordResetToken",void 0),(0,o.__decorate)([(0,s.Prop)(),(0,o.__metadata)("design:type",Number)],e.prototype,"passwordResetTokenExpiresIn",void 0),(0,o.__decorate)([(0,s.pre)("save",(function(e){return(0,o.__awaiter)(this,void 0,void 0,(function(){var t;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return this.isModified("password")?(t=this,[4,(0,a.hash)(this.password,12)]):[3,2];case 1:t.password=r.sent(),this.passwordConfirm=void 0,!this.isNew&&(this.passwordChangedAt=new Date),r.label=2;case 2:return e(),[2]}}))}))})),(0,s.modelOptions)({options:{allowMixed:s.Severity.ALLOW}})],e)}();t.UserModel=(0,s.getModelForClass)(u)},554:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(860),s=r(602),a=r(540),n=r(817),i=r(84),u=r(465),d=(0,o.Router)().use(a.authenticated);d.get("/monthly-plan/:year",(0,i.restrictTo)(u.Role.admin,u.Role["lead-guide"]),s.getMonthlyPlan),d.get("/stats",s.getTourStats),d.get("/top-cheap-tours",n.cheapTours,s.getAllTours),d.get("/",s.getAllTours),d.post("/",s.createTour),d.get("/:id",s.getTourById),d.patch("/:id",s.updateTour),d.delete("/:id",s.deleteTour),t.default=d},471:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(860),s=r(464),a=(0,o.Router)();a.post("/forgotPassword",s.forgotPassword),a.post("/resetPassword/:resetToken",s.resetPassword),a.post("/signup",s.signup),a.post("/login",s.login),t.default=a},155:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.HttpStatus=void 0,(r=t.HttpStatus||(t.HttpStatus={}))[r.CONTINUE=100]="CONTINUE",r[r.SWITCHING_PROTOCOLS=101]="SWITCHING_PROTOCOLS",r[r.PROCESSING=102]="PROCESSING",r[r.EARLYHINTS=103]="EARLYHINTS",r[r.OK=200]="OK",r[r.CREATED=201]="CREATED",r[r.ACCEPTED=202]="ACCEPTED",r[r.NON_AUTHORITATIVE_INFORMATION=203]="NON_AUTHORITATIVE_INFORMATION",r[r.NO_CONTENT=204]="NO_CONTENT",r[r.RESET_CONTENT=205]="RESET_CONTENT",r[r.PARTIAL_CONTENT=206]="PARTIAL_CONTENT",r[r.AMBIGUOUS=300]="AMBIGUOUS",r[r.MOVED_PERMANENTLY=301]="MOVED_PERMANENTLY",r[r.FOUND=302]="FOUND",r[r.SEE_OTHER=303]="SEE_OTHER",r[r.NOT_MODIFIED=304]="NOT_MODIFIED",r[r.TEMPORARY_REDIRECT=307]="TEMPORARY_REDIRECT",r[r.PERMANENT_REDIRECT=308]="PERMANENT_REDIRECT",r[r.BAD_REQUEST=400]="BAD_REQUEST",r[r.UNAUTHORIZED=401]="UNAUTHORIZED",r[r.PAYMENT_REQUIRED=402]="PAYMENT_REQUIRED",r[r.FORBIDDEN=403]="FORBIDDEN",r[r.NOT_FOUND=404]="NOT_FOUND",r[r.METHOD_NOT_ALLOWED=405]="METHOD_NOT_ALLOWED",r[r.NOT_ACCEPTABLE=406]="NOT_ACCEPTABLE",r[r.PROXY_AUTHENTICATION_REQUIRED=407]="PROXY_AUTHENTICATION_REQUIRED",r[r.REQUEST_TIMEOUT=408]="REQUEST_TIMEOUT",r[r.CONFLICT=409]="CONFLICT",r[r.GONE=410]="GONE",r[r.LENGTH_REQUIRED=411]="LENGTH_REQUIRED",r[r.PRECONDITION_FAILED=412]="PRECONDITION_FAILED",r[r.PAYLOAD_TOO_LARGE=413]="PAYLOAD_TOO_LARGE",r[r.URI_TOO_LONG=414]="URI_TOO_LONG",r[r.UNSUPPORTED_MEDIA_TYPE=415]="UNSUPPORTED_MEDIA_TYPE",r[r.REQUESTED_RANGE_NOT_SATISFIABLE=416]="REQUESTED_RANGE_NOT_SATISFIABLE",r[r.EXPECTATION_FAILED=417]="EXPECTATION_FAILED",r[r.I_AM_A_TEAPOT=418]="I_AM_A_TEAPOT",r[r.MISDIRECTED=421]="MISDIRECTED",r[r.UNPROCESSABLE_ENTITY=422]="UNPROCESSABLE_ENTITY",r[r.FAILED_DEPENDENCY=424]="FAILED_DEPENDENCY",r[r.PRECONDITION_REQUIRED=428]="PRECONDITION_REQUIRED",r[r.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",r[r.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",r[r.NOT_IMPLEMENTED=501]="NOT_IMPLEMENTED",r[r.BAD_GATEWAY=502]="BAD_GATEWAY",r[r.SERVICE_UNAVAILABLE=503]="SERVICE_UNAVAILABLE",r[r.GATEWAY_TIMEOUT=504]="GATEWAY_TIMEOUT",r[r.HTTP_VERSION_NOT_SUPPORTED=505]="HTTP_VERSION_NOT_SUPPORTED"},465:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Role=void 0,(r=t.Role||(t.Role={})).user="user",r.guide="guide",r["lead-guide"]="lead-guide",r.admin="admin"},105:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApiFeatures=void 0;var r=function(){function e(e,t){this.query=e,this.req=t}return e.prototype.sort=function(){return this.req.query.sort&&this.query.sort(this.req.query.sort.split(",").join(" ")),this},e.prototype.fields=function(){return this.req.query.fields&&this.query.select(this.req.query.fields.split(",").join(" ")),this},e.prototype.paginate=function(){var e=this.req.query.page?+this.req.query.page:1,t=this.req.query.limit?+this.req.query.limit:3,r=(e-1)*t;return this.query.skip(r),this.query.limit(t),this},e}();t.ApiFeatures=r},268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.catchAsync=void 0,t.catchAsync=function(e){return function(t,r,o){e(t,r,o).catch((function(e){return o(e)}))}}},211:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomError=void 0;var o=r(752),s=function(e){function t(t,r){var o=e.call(this,t)||this;return o.statusCode=r,o.status=(""+r).startsWith("4")?"fail":"error",Error.captureStackTrace(o,o.constructor),o}return(0,o.__extends)(t,e),t}(Error);t.CustomError=s},490:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateJwt=void 0;var o=(0,r(752).__importDefault)(r(344)),s=r(840);t.generateJwt=function(e){var t=(0,s.getEnv)("JWT_SECRET_KEY");return o.default.sign(e,t,{expiresIn:"1d"})}},840:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEnv=void 0,t.getEnv=function(e){var t=process.env[e];if(!t)throw new Error(e+" not found in environment variables");return t}},377:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sendEmail=void 0;var o=r(752),s=r(184),a=r(840);t.sendEmail=function(e){return(0,o.__awaiter)(void 0,void 0,void 0,(function(){var t,r;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return t=(0,s.createTransport)({host:(0,a.getEnv)("EMAIL_HOST"),port:+(0,a.getEnv)("EMAIL_PORT"),auth:{user:(0,a.getEnv)("EMAIL_USERNAME"),pass:(0,a.getEnv)("EMAIL_PASSWORD")}}),r={from:"Optimus Prime <optimusprime@gmail.com>",to:e.email,subject:e.subject,text:e.text},[4,t.sendMail(r)];case 1:return o.sent(),[2]}}))}))}},868:e=>{e.exports=require("@typegoose/typegoose")},432:e=>{e.exports=require("bcryptjs")},142:e=>{e.exports=require("dotenv")},860:e=>{e.exports=require("express")},344:e=>{e.exports=require("jsonwebtoken")},517:e=>{e.exports=require("lodash")},185:e=>{e.exports=require("mongoose")},470:e=>{e.exports=require("morgan")},184:e=>{e.exports=require("nodemailer")},752:e=>{e.exports=require("tslib")},113:e=>{e.exports=require("crypto")},837:e=>{e.exports=require("util")}},t={};function r(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}(()=>{var e=r(752),t=(0,e.__importDefault)(r(142)),o=(0,e.__importDefault)(r(860)),s=r(185),a=((0,e.__importDefault)(r(470)),r(547)),n=r(211),i=r(840),u=(0,e.__importDefault)(r(554)),d=(0,e.__importDefault)(r(471));t.default.config({path:process.cwd()+"/config.env"});var c=process.env.PORT||4e3,p=(0,i.getEnv)("DATABASE_URL").replace("<PASSWORD>",(0,i.getEnv)("DATABASE_PASSWORD")),_=(0,o.default)();(0,s.connect)(p,{autoIndex:!0},(function(e){if(e)return console.log(e.message);console.log("✔️ Successfully connected to the database")})),_.use(o.default.urlencoded({extended:!0})),_.use(o.default.json()),_.use(o.default.static(process.cwd()+"/public")),_.use("/api/v1/tours",u.default),_.use("/api/v1/users",d.default),_.all("*",(function(e,t,r){r(new n.CustomError(" Route "+e.originalUrl+" doesn't exist on this server",400))})),_.use(a.globalErrors);var l=_.listen(c,(function(){return console.log("🚀 Server started on http://localhost:"+c)}));process.on("unhandledRejection",(function(e){e&&(console.log(e.name+" - "+e.message),l.close((function(){return process.exit(1)})))}))})()})();